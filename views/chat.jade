extends layout
block content
	title= Chat
	head
		link(rel='stylesheet' href='bootstrap.min.css' type='text/css' mdeia='all')
	style.
		
		.form-group
			{
				margin-top: 41%;
				margin-left: 40%;
				position:fixed;
				bottom:10px;
				height:50px;				
			}
		.Almessage
			{
				position:relative;
				padding-top:20px;	
				padding-right:70%
			}
		.data
			{
				position:relative;
				color:white;
				font-size:150%;
				padding-right:10%;
			}
		.text
			{
				color:green;
				font-size:150%;
			}
		#field
			{
				background-color:#252D2D;
				width:35%;	
				border-radius: 30px;
				margin-bottom:5%;
				overflow:hidden;
				padding-right:10px;
			}
		.panel
			{
				background-color:#252D2D;
				border-radius: 30px;
			}
		.message
			{
				position:relative;
				padding-top:20px;	
				padding-left:70%;
			}
		.Aldata
			{
				color:red;
				font-size:150%;
			}
		.Altext
			{
				color:green;
				font-size:150%;
			}
		



	body
		center
			div(id='field')
				div(id ='messages')
		div.inp
			form(role='form' class='form-inline' onsubmit='sendMessage(this.message.value); this.message.value = ""; return false;')
				div.form-group
					input(type='text' class='form-control' name='message' placeholder='Enter your message' autocomplete='off')
					button(type='submit' class='btn btn-success'): i(class='glyphicon glyphicon-send')
					
				
	script(type='text/javascript').
		var socket = io({transports: ['websocket']}),
			messagesContainer = document.getElementById('messages');
			//mymessContainer = document.getElementById('AlianMess');

		socket.on('messageSent', (data) => {
			renderMessage(data);
		});

		socket.on('messageReceived',(data)=>{
			renderAlianMess(data);
		});

		function sendMessage(message) {
			if (message) {
				socket.emit('message', {message: message});
			}
		}

		function renderMessage(data) // Свое сообщение 
		{
			var div = document.createElement('DIV');
			div.innerHTML = '<div class="message"><div class="panel panel-dafault><div class="panel-heading"><div class="data">'+data.name+'</div><div class="panel-body"><div class="text">'+data.text+'</div></div></div></div>';


			messagesContainer.insertBefore(div, null);
		}
		
		function renderAlianMess(data) // Сообщение от другого юзера 
		{
			var div = document.createElement('DIV');
			div.innerHTML ='<div class="Almessage"><div class="panel panel-dafault><div class="panel-heading"><div class="Aldata">'+data.name+'</div><div class="panel-body"><div class="Altext">'+data.text+'</div></div></div></div>';



			messagesContainer.insertBefore(div,null);
		}